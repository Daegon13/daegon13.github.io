---
/* Página de Contacto (sin backend)
   - Envía por mailto a damgmarin13@gmail.com armando el asunto y el cuerpo
   - Validación mínima con atributos HTML
   - No depende de librerías, no toca tailwind.config
*/
import BaseLayout from "../layouts/BaseLayout.astro";
import { EMAIL, WHATSAPP_BASE_URL, WHATSAPP_NUMBER_E164 } from "../lib/contact";

const title = "Contacto – Marin.dev";
const description = "Contame tu proyecto y recibí una estimación en 24 horas.";
const url = "https://daegon13.github.io/contacto";
const image = "/og-default.png";
---
<BaseLayout {title} {description} {url} {image}>
  <section class="py-12 md:py-16">
    <h1 class="text-2xl md:text-3xl font-semibold">Contacto</h1>
    <p class="mt-2 text-gray-500">Elegí un canal. Si querés ir rápido, mandame un WhatsApp con mensaje guiado y te respondo en menos de 24 horas.</p>

    <form id="contacto" class="mt-8 max-w-xl space-y-4">
      <!-- Nombre -->
      <div>
        <label for="nombre" class="block text-sm font-medium">Nombre:</label>
        <input id="nombre" name="nombre" type="text" required
               class="mt-1 w-full rounded-lg border border-gray-300/70 dark:border-gray-700/70 bg-transparent px-3 py-2" />
      </div>

      <!-- Email -->
      <div>
        <label for="email" class="block text-sm font-medium">Email:</label>
        <input id="email" name="email" type="email" required
               class="mt-1 w-full rounded-lg border border-gray-300/70 dark:border-gray-700/70 bg-transparent px-3 py-2" />
      </div>

      <!-- Presupuesto estimado -->
      <div>
        <label for="presupuesto" class="block text-sm font-medium">Presupuesto estimado - (USD):</label>
        <input id="presupuesto" name="presupuesto" type="number" min="0" step="50"
               class="mt-1 w-full rounded-lg border border-gray-300/70 dark:border-gray-700/70 bg-transparent px-3 py-2" />
      </div>

      <!-- Plazo estimado -->
      <div>
        <label for="plazo" class="block text-sm font-medium">Plazo requerido(si aplica) - (días):</label>
        <input id="plazo" name="plazo" type="number" min="1" step="1" 
               class="mt-1 w-full rounded-lg border border-gray-300/70 dark:border-gray-700/70 bg-transparent px-3 py-2" />
      </div>

      <!-- Mensaje -->
      <div>
        <label for="mensaje" class="block text-sm font-medium">Resumen de tu negocio:</label>
        <textarea id="mensaje" name="mensaje" rows="5" required
                  class="mt-1 w-full rounded-lg border border-gray-300/70 dark:border-gray-700/70 bg-transparent px-3 py-2"></textarea>
      </div>

      <!-- Acción -->
      <div class="pt-2">
        <button type="submit"
                class="inline-flex items-center justify-center rounded-xl px-5 py-3 text-sm font-medium bg-gray-900 text-white hover:bg-gray-800 dark:bg-gray-100 dark:text-gray-900 dark:hover:bg-white transition">
          Abrir WhatsApp con este mensaje
        </button>
      </div>

      <!-- Fallback si JS está deshabilitado -->
      <noscript>
        <p class="mt-3 text-sm text-gray-500">
          Si tu navegador no permite enviar el formulario, escribime a
          <a class="underline" href={`mailto:${EMAIL}`}>{EMAIL}</a>.
        </p>
      </noscript>
    </form>
  </section>

  <!-- Script mínimo: arma un WhatsApp con los datos -->
  <script>
    const form = document.getElementById('contacto');
    const WA = "59897316092"; // UY (+598) + 97316092

    form?.addEventListener('submit', (e) => {
      e.preventDefault();
      const data = new FormData(form);

      const nombre = String(data.get('nombre') || '').trim();
      const email = String(data.get('email') || '').trim();
      const presupuesto = String(data.get('presupuesto') || '').trim();
      const plazo = String(data.get('plazo') || '').trim();
      const mensaje = String(data.get('mensaje') || '').trim();

      const params = new URLSearchParams(window.location.search);
      const plan = params.get('plan');

      const lines = [
        `Hola Diego, soy ${nombre || '[Nombre]'}.`,
        plan ? `Quiero el plan: ${plan}` : '',
        email ? `Email: ${email}` : '',
        presupuesto ? `Presupuesto estimado: USD ${presupuesto}` : '',
        plazo ? `Plazo requerido: ${plazo} días` : '',
        '',
        'Resumen:',
        mensaje || '[Contame tu negocio y qué objetivo buscás]',
      ].filter(Boolean);

      const text = lines.join(String.fromCharCode(10));
      const href = `https://wa.me/${WA}?text=${encodeURIComponent(text)}`;
      window.open(href, '_blank', 'noopener,noreferrer');
    });
  </script>
</BaseLayout>
